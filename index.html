<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWP SERVER</title>
    <style>
        /* CSS الأصلي من ملفك - لم يتم لمسه */
        :root {
            --bg-color-dark: #0a0a0a;
            --text-color-dark: #fff;
            --card-bg-dark: rgba(25, 25, 35, 0.85);
            --feature-card-bg-dark: rgba(45, 45, 65, 0.7);
            --border-color-dark: rgba(255, 255, 255, 0.1);
            --primary-color: #7289da;
            --primary-shadow-color: rgba(114, 137, 218, 0.7);
            --input-bg-dark: rgba(30, 30, 30, 0.8);
            --placeholder-color-dark: #ccc;
        }

        .light-mode {
            --bg-color-dark: #f0f2f5;
            --text-color-dark: #333;
            --card-bg-dark: rgba(255, 255, 255, 0.9);
            --feature-card-bg-dark: rgba(240, 240, 245, 0.9);
            --border-color-dark: rgba(0, 0, 0, 0.1);
            --input-bg-dark: rgba(255, 255, 255, 0.9);
            --placeholder-color-dark: #666;
        }

        body {
            font-family: Arial, sans-serif; /* حافظت على هذا كما هو في ملفك الأصلي */
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            position: relative;
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://cdn.discordapp.com/attachments/1218768853755291660/1247071689255620618/IMG_4281.jpg?ex=665e7146&is=665d1fc6&hm=703848b30f8f11466ac135a5ac8f8306059d0426177894a73229b465715e4f45&');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .light-mode .background-image {
            opacity: 0.05;
        }

        header {
            background-color: var(--card-bg-dark);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color-dark);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 50px;
            margin-left: 10px;
        }

        .logo h1 {
            margin: 0;
            font-size: 1.8em;
            color: var(--primary-color);
            text-shadow: 0 0 8px var(--primary-shadow-color);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px var(--primary-shadow-color), 0 0 10px var(--primary-shadow-color);
            }
            to {
                text-shadow: 0 0 10px var(--primary-shadow-color), 0 0 20px var(--primary-shadow-color);
            }
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        nav ul li a {
            color: var(--text-color-dark);
            text-decoration: none;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        nav ul li a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-color);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: -1;
        }

        nav ul li a:hover::before {
            transform: translateX(0);
        }

        nav ul li a:hover {
            color: #fff;
        }

        .current-page {
            background-color: var(--primary-color);
            color: #fff !important;
        }

        .mode-toggle {
            background: var(--input-bg-dark);
            border: 1px solid var(--border-color-dark);
            color: var(--text-color-dark);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        main {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page-content {
            background-color: var(--card-bg-dark);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 900px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
            border: 1px solid var(--border-color-dark);
            box-sizing: border-box;
        }

        .page-content.active {
            display: block;
        }

        h2 {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        h2::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 5px;
        }

        .login-section {
            margin-bottom: 20px;
        }

        .login-section input[type="text"] {
            padding: 10px;
            border: 1px solid var(--border-color-dark);
            border-radius: 5px;
            background-color: var(--input-bg-dark);
            color: var(--text-color-dark);
            margin-left: 10px;
            width: 150px;
        }

        .login-section input::placeholder {
            color: var(--placeholder-color-dark);
        }

        .login-section button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .login-section button:hover {
            background-color: #5c6ea0;
        }

        .login-display {
            margin-top: 15px;
            font-size: 1.1em;
        }

        .visitor-counter {
            margin-top: 20px;
            font-size: 1.1em;
            color: var(--text-color-dark);
        }

        .features-grid, .rules-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            text-align: right;
            margin-top: 20px;
        }

        .feature-card {
            background-color: var(--feature-card-bg-dark);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color-dark);
            animation: float 3s ease-in-out infinite alternate;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .feature-card h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .rules-list {
            display: flex;
            flex-direction: column;
        }

        .rules-list p {
            background-color: var(--feature-card-bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color-dark);
            text-align: right;
        }

        .rating-input {
            margin-bottom: 20px;
        }

        .rating-input textarea {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid var(--border-color-dark);
            border-radius: 5px;
            background-color: var(--input-bg-dark);
            color: var(--text-color-dark);
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
            text-align: right;
        }

        .rating-input input::placeholder, .rating-input textarea::placeholder {
            color: var(--placeholder-color-dark);
        }

        .reviews-section {
            margin-top: 30px;
            text-align: right;
        }

        .review-card {
            background-color: var(--feature-card-bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color-dark);
            text-align: right;
        }

        .review-card strong {
            color: var(--primary-color);
        }

        .review-card p {
            margin-top: 5px;
            margin-bottom: 0;
        }

        footer {
            margin-top: auto;
            background-color: var(--card-bg-dark);
            color: var(--text-color-dark);
            text-align: center;
            padding: 15px;
            border-top: 1px solid var(--border-color-dark);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }

            .logo {
                flex-direction: column;
            }

            .logo img {
                margin-left: 0;
                margin-bottom: 10px;
            }
        }

        /* --- CSS الجديد المضاف فقط للأقسام الجديدة والميزات --- */
        /* ألوان رسائل النجاح والخطأ */
        :root {
            --success-color: #28a745;
            --error-color: #dc3545;
        }
        
        .message-area {
            margin-top: 10px;
            font-weight: bold;
            display: none;
            padding: 10px;
            border-radius: 5px;
            color: #fff;
            text-align: center;
        }

        .message-area.success {
            background-color: var(--success-color);
            display: block;
        }

        .message-area.error {
            background-color: var(--error-color);
            display: block;
        }

        /* تنسيق زر Discord وأيقونة المستخدم */
        .discord-login-button {
            background-color: #7289da; /* Discord blue */
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        .discord-login-button:hover {
            background-color: #5c6ea0;
        }
        .discord-login-button img {
            height: 20px;
            width: 20px;
        }

        .logged-in-user-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px; /* للحفاظ على تباعد مماثل لـ .login-display الأصلي */
            font-size: 1.1em; /* للحفاظ على حجم الخط */
            flex-wrap: wrap; /* للسماح بالعناصر بالتفاف في الشاشات الصغيرة */
        }
        .logged-in-user-info img {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            border: 2px solid var(--primary-color);
        }
        .logged-in-user-info button {
            background-color: var(--error-color);
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .logged-in-user-info button:hover {
            background-color: #c82333;
        }

        /* ستايلات لوحة المشرفين */
        #admin-panel {
            /* تستخدم ستايلات .page-content الأساسية */
        }
        .admin-review-item {
            display: flex;
            flex-direction: column; /* Stack info and actions vertically */
            background-color: var(--feature-card-bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color-dark);
            text-align: right;
        }
        .admin-review-item .review-info {
            flex-grow: 1;
            margin-bottom: 10px; /* Space between info and buttons */
        }
        .admin-review-item .review-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end; /* Align buttons to the right */
            flex-wrap: wrap; /* Allow buttons to wrap */
        }
        .admin-review-item .review-actions button {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .admin-review-item .review-actions .approve-btn {
            background-color: var(--success-color);
            color: #fff;
        }
        .admin-review-item .review-actions .approve-btn:hover {
            background-color: #218838;
        }
        .admin-review-item .review-actions .delete-btn {
            background-color: var(--error-color);
            color: #fff;
        }
        .admin-review-item .review-actions .delete-btn:hover {
            background-color: #c82333;
        }

        /* ستايلات قسم التقييمات السابقة - يعيد استخدام ستايلات .reviews-section و .review-card */
        #previous-reviews-section {
            margin-top: 30px; /* إضافة تباعد عن قسم التقييمات الحالي */
            text-align: right;
        }
        #previous-reviews-section h2 {
            margin-bottom: 20px;
        }

        /* ستايلات قسم حالة السيرفر */
        #server-status-page {
            /* تستخدم ستايلات .page-content الأساسية */
        }
        .server-status-info {
            text-align: right;
            margin-top: 20px;
        }
        .server-status-info p {
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex; /* لترتيب المؤشر والنص بشكل أفقي */
            align-items: center;
            justify-content: flex-end; /* لمحاذاة النص إلى اليمين */
        }
        .server-status-info p strong {
            color: var(--primary-color);
            margin-left: 5px; /* مسافة بين النص والمؤشر */
        }
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .status-indicator.online {
            background-color: var(--success-color);
        }
        .status-indicator.offline {
            background-color: var(--error-color);
        }
    </style>
</head>
<body>
    <div class="background-image"></div>
    <header>
        <div class="logo">
            <img src="https://cdn.discordapp.com/attachments/1218768853755291660/1247071688928522300/IMG_4282.jpg?ex=665e7146&is=665d1fc6&hm=5e2b20f929d2919d115e51d957d17466540b953d10033036573c9f2255d61009&" alt="SWP Logo">
            <h1>SWP SERVER</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#" onclick="showPage('home-page', this)">الرئيسية</a></li>
                <li><a href="#" onclick="showPage('features-page', this)">الميزات</a></li>
                <li><a href="#" onclick="showPage('rules-page', this)">القوانين</a></li>
                <li><a href="#" onclick="showPage('rating-page', this)">التقييمات</a></li>
                <li><a href="#" onclick="showPage('server-status-page', this)">حالة السيرفر</a></li>
                <li><a href="#" onclick="showPage('contact-page', this)">تواصل معنا</a></li>
                <li id="admin-panel-nav-item" style="display: none;"><a href="#" onclick="showPage('admin-panel', this)">لوحة المشرفين</a></li>
            </ul>
        </nav>
        <div>
            <button id="mode-toggle" class="mode-toggle">
                <span id="mode-icon">☀️</span>
            </button>
            <div id="auth-container">
                <button id="discord-login-btn" class="discord-login-button" onclick="loginWithDiscord()">
                    <img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/62594511d73c7344778d2238_Discord-Logo-White.png" alt="Discord Logo">
                    تسجيل الدخول عبر Discord
                </button>
                <div id="logged-in-user-info" class="logged-in-user-info" style="display: none;">
                    <span id="logged-in-username"></span>
                    <img id="logged-in-avatar" src="" alt="User Avatar" style="display: none;">
                    <button onclick="logoutUser()">تسجيل الخروج</button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div id="home-page" class="page-content active">
            <h2>مرحباً بك في سيرفر SWP!</h2>
            <p>نحن مجتمع ألعاب يجمع بين محبي Minecraft و One Piece. انضم إلينا لخوض مغامرات لا تُنسى، بناء إمبراطوريات، وخوض معارك ملحمية في عالم مليء بالإثارة والتشويق.</p>
            <p>سيرفرنا يقدم تجربة فريدة تجمع بين أفضل ما في العالمين، مع فعاليات مستمرة ومجتمع داعم ومرحب. سواء كنت تبحث عن تحديات البقاء، حروب الفصائل، أو ببساطة مكان للاسترخاء والدردشة، SWP هو وجهتك المثالية.</p>
            <div class="login-section">
                <div id="visitor-counter" class="visitor-counter">
                    عدد الزوار: <span id="visitor-count">0</span>
                </div>
            </div>
        </div>

        <div id="features-page" class="page-content">
            <h2>ميزات سيرفرنا</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>نظام One Piece متكامل</h3>
                    <p>استمتع بتجربة One Piece فريدة مع فواكه الشيطان، الهاكي، ونظام قتالي متقدم. اختر طريقك كقرصان أو جندي بحر وكن أسطورة في عالمنا.</p>
                </div>
                <div class="feature-card">
                    <h3>عوالم متعددة</h3>
                    <p>استكشف عوالم مختلفة مليئة بالأسرار والتحديات. من البحار الشاسعة إلى الجزر الغامضة، كل زاوية تحمل مغامرة جديدة.</p>
                </div>
                <div class="feature-card">
                    <h3>اقتصاد واقعي</h3>
                    <p>شارك في نظام اقتصادي ديناميكي، قم بالتجارة، أنشئ المزارع، وكن أغنى شخص في السيرفر. الفرص لا حصر لها!</p>
                </div>
                <div class="feature-card">
                    <h3>فعاليات مستمرة</h3>
                    <p>انضم إلى فعالياتنا اليومية والأسبوعية للحصول على مكافآت حصرية وتجارب لا تُنسى. من حروب الأطراف إلى مسابقات البناء، هناك دائمًا شيء جديد.</p>
                </div>
                <div class="feature-card">
                    <h3>مجتمع نشط</h3>
                    <p>كن جزءًا من مجتمع ودود وداعم. كوّن صداقات، انضم إلى فصائل، وتفاعل مع لاعبين من جميع أنحاء العالم.</p>
                </div>
                <div class="feature-card">
                    <h3>حماية الأراضي</h3>
                    <p>احمِ ممتلكاتك وبناءاتك من التخريب بفضل نظام حماية الأراضي المتقدم الخاص بنا، واستمتع باللعب بأمان.</p>
                </div>
            </div>
        </div>

        <div id="rules-page" class="page-content">
            <h2>قوانين السيرفر</h2>
            <div class="rules-list">
                <p>1. يُمنع منعًا باتًا الغش أو استخدام أي برامج غير مسموح بها.</p>
                <p>2. احترم جميع اللاعبين والمشرفين. يُمنع السب والقذف أو أي سلوك غير لائق.</p>
                <p>3. يُمنع استغلال الأخطاء (Bugs) في اللعبة أو السيرفر. يجب الإبلاغ عنها فورًا.</p>
                <p>4. لا تُسئ استخدام الأوامر أو الصلاحيات المعطاة لك.</p>
                <p>5. يُمنع تكرار الرسائل المزعجة (Spam) في الدردشة.</p>
                <p>6. يُمنع الترويج لسيرفرات أو مواقع أخرى داخل السيرفر بدون إذن.</p>
                <p>7. يجب الالتزام بجميع القوانين الإضافية التي قد تُنشر من قبل الإدارة.</p>
            </div>
        </div>

        <div id="rating-page" class="page-content">
            <h2>تقييمات اللاعبين</h2>
            <div class="rating-input">
                <textarea id="review-text" placeholder="اكتب تقييمك هنا..."></textarea>
                <button onclick="submitReview()">إرسال التقييم</button>
                <div id="review-message" class="message-area" style="display: none;"></div>
            </div>
            <div id="reviews-list" class="reviews-section">
                <h3>أحدث التقييمات:</h3>
                </div>

            <div id="previous-reviews-section" class="reviews-section" style="display: none;">
                <h2>جميع التقييمات السابقة المعتمدة</h2>
                <div id="approved-reviews-list" class="reviews-section">
                    <p id="no-approved-reviews" style="display: none;">لا توجد تقييمات سابقة معتمدة حالياً.</p>
                </div>
            </div>
        </div>

        <div id="server-status-page" class="page-content" style="display: none;">
            <h2>حالة سيرفر ماين كرافت</h2>
            <div id="server-status-info" class="server-status-info">
                <p>اسم السيرفر: <strong>SWP Server</strong></p>
                <p>الحالة: <span id="server-status-indicator" class="status-indicator"></span> <strong id="server-status-text">جاري التحميل...</strong></p>
                <p>عدد اللاعبين: <strong id="players-online">جاري التحميل...</strong></p>
            </div>
        </div>

        <div id="contact-page" class="page-content">
            <h2>تواصل معنا</h2>
            <p>للاستفسارات أو الدعم الفني، يمكنك التواصل معنا عبر:</p>
            <p><strong>البريد الإلكتروني:</strong> support@swpserver.com</p>
            <p><strong>ديسكورد:</strong> انضم إلى سيرفر الديسكورد الخاص بنا من <a href="https://discord.gg/yourdiscordinvite" target="_blank" style="color: var(--primary-color); text-decoration: none;">هنا</a></p>
            <p><strong>تويتر:</strong> <a href="https://twitter.com/swpserver" target="_blank" style="color: var(--primary-color); text-decoration: none;">@SWPServer</a></p>
        </div>

        <div id="admin-panel" class="page-content" style="display: none;">
            <h2>لوحة المشرفين</h2>
            <p>إدارة التقييمات المعلقة بانتظار الموافقة.</p>
            <div id="pending-reviews-list" class="reviews-section">
                <h3>التقييمات المعلقة:</h3>
                <p id="no-pending-reviews" style="display: none;">لا توجد تقييمات معلقة حالياً.</p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 SWP SERVER. جميع الحقوق محفوظة.</p>
        <p>عدد الزوار الإجمالي: <span id="total-visitor-count">جاري التحميل...</span></p>
    </footer>

    <script>
        // References to original elements
        const modeToggle = document.getElementById('mode-toggle');
        const modeIcon = document.getElementById('mode-icon');
        const visitorCountSpan = document.getElementById('visitor-count');
        const totalVisitorCountSpan = document.getElementById('total-visitor-count');

        // References to new elements for Discord login
        const authContainer = document.getElementById('auth-container');
        const discordLoginBtn = document.getElementById('discord-login-btn');
        const loggedInUserInfo = document.getElementById('logged-in-user-info');
        const loggedInUsernameSpan = document.getElementById('logged-in-username');
        const loggedInAvatarImg = document.getElementById('logged-in-avatar');

        // References to new elements for Reviews and Admin Panel
        const reviewMessage = document.getElementById('review-message');
        const reviewsList = document.getElementById('reviews-list');
        const adminPanelNavItem = document.getElementById('admin-panel-nav-item');
        const pendingReviewsList = document.getElementById('pending-reviews-list');
        const noPendingReviewsMsg = document.getElementById('no-pending-reviews');
        const approvedReviewsList = document.getElementById('approved-reviews-list');
        const noApprovedReviewsMsg = document.getElementById('no-approved-reviews');

        // References to new elements for Server Status
        const serverStatusText = document.getElementById('server-status-text');
        const serverStatusIndicator = document.getElementById('server-status-indicator');
        const playersOnline = document.getElementById('players-online');


        // --- Backend API Endpoints (Conceptual - YOU NEED TO IMPLEMENT THESE ON YOUR SERVER) ---
        // سطر 494: استبدل 'http://localhost:3000' بعنوان URL لخادمك الخلفي (Backend Server URL)
        // مثال: 'https://api.yourdomain.com/api' أو 'https://your-backend-app.herokuapp.com/api'
        const BASE_API_URL = 'http://localhost:3000/api'; 

        // --- Discord OAuth2 Configuration ---
        // سطر 499: يجب أن تحصل على هذه المعلومات من بوابة مطوري Discord (Discord Developer Portal)
        // قم بإنشاء تطبيق جديد (New Application)، ثم اذهب إلى OAuth2 -> General
        // CLIENT_ID: هو معرف تطبيقك (Application ID)
        // REDIRECT_URI: يجب أن يكون هو نفس عنوان URL الذي ستعود إليه بعد المصادقة في Discord.
        //              ويجب أن يكون مُضافًا في إعدادات OAuth2 في بوابة مطوري Discord.
        //              مثال: 'http://localhost:3000/auth/discord/callback' أو 'https://yourdomain.com/auth/discord/callback'
        const DISCORD_CLIENT_ID = 'YOUR_DISCORD_CLIENT_ID'; // <--- ضع هنا Discord Client ID الخاص بك
        const DISCORD_REDIRECT_URI = 'http://localhost:3000/auth/discord/callback'; // <--- ضع هنا Redirect URI الخاص بك
        const DISCORD_SCOPES = 'identify'; // نطاق المصادقة الأساسي للحصول على هوية المستخدم

        // --- Admin Discord User IDs (FOR DEMONSTRATION ONLY - SHOULD BE MANAGED ON BACKEND FOR SECURITY) ---
        // سطر 508: في نظام حقيقي، هذا التحقق يجب أن يتم على الخادم (Backend)
        // الخادم هو الذي يجب أن يمتلك قائمة بمعرفات المشرفين ويتحقق منها
        // أنا أضعها هنا فقط لتوضيح كيفية عمل الواجهة الأمامية مع فكرة المشرفين.
        // استبدل بمعرفات Discord ID الحقيقية للمشرفين
        const ADMIN_DISCORD_IDS = ['YOUR_ADMIN_DISCORD_ID_1', 'YOUR_ADMIN_DISCORD_ID_2']; 
        // <--- ضع هنا معرفات Discord ID الخاصة بالمشرفين الذين تسمح لهم بالوصول إلى لوحة المشرفين

        // --- وظائف تبديل الوضع (Theme Toggling) ---
        function setMode(mode) {
            if (mode === 'light') {
                document.body.classList.add('light-mode');
                modeIcon.textContent = '🌙'; // Moon icon for light mode (to switch to dark)
                localStorage.setItem('theme', 'light');
            } else {
                document.body.classList.remove('light-mode');
                modeIcon.textContent = '☀️'; // Sun icon for dark mode (to switch to light)
                localStorage.setItem('theme', 'dark');
            }
        }

        modeToggle.addEventListener('click', () => {
            if (document.body.classList.contains('light-mode')) {
                setMode('dark');
            } else {
                setMode('light');
            }
        });

        // --- وظائف التنقل بين الصفحات ---
        function showPage(pageId, clickedLink = null) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
                // إخفاء الأقسام الجديدة عند التبديل لضمان عدم تداخل العرض
                if (page.id === 'previous-reviews-section' || page.id === 'server-status-page' || page.id === 'admin-panel') {
                    page.style.display = 'none';
                }
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                // التأكد من إظهار الأقسام الجديدة عند تفعيلها
                if (pageId === 'previous-reviews-section' || pageId === 'server-status-page' || pageId === 'admin-panel') {
                    targetPage.style.display = 'block';
                }
            }


            // تحديث رابط التنقل النشط
            document.querySelectorAll('nav ul li a').forEach(link => {
                link.classList.remove('current-page');
            });
            if (clickedLink) {
                clickedLink.classList.add('current-page');
            } else { 
                // إذا لم يتم النقر على رابط محدد (مثل عند تحميل الصفحة أو إعادة التوجيه)
                const navLink = document.querySelector(`nav ul li a[onclick*="showPage('${pageId}'"]`);
                if (navLink) navLink.classList.add('current-page');
            }

            // إجراءات محددة لصفحات معينة
            if (pageId === 'rating-page') { 
                loadReviews(); // تحميل أحدث التقييمات
                loadPreviousReviews(); // تحميل جميع التقييمات المعتمدة
            } else if (pageId === 'admin-panel') {
                loadPendingReviews();
            } else if (pageId === 'server-status-page') {
                updateServerStatus();
            }
        }

        // --- دمج تسجيل الدخول/الخروج و Discord OAuth2 ---
        function loginWithDiscord() {
            const discordAuthUrl = `https://discord.com/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}&response_type=code&scope=${DISCORD_SCOPES}`;
            window.location.href = discordAuthUrl;
        }

        async function handleDiscordCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (code) {
                try {
                    const response = await fetch(`${BASE_API_URL}/auth/discord`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code, redirectUri: DISCORD_REDIRECT_URI })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'فشل تسجيل الدخول عبر Discord');
                    }

                    const data = await response.json();
                    localStorage.setItem('discord_user', JSON.stringify(data.user));
                    localStorage.setItem('session_token', data.sessionToken);

                    window.history.replaceState({}, document.title, window.location.pathname);
                    updateLoginDisplay();
                    showPage('home-page'); 
                } catch (error) {
                    console.error('Error during Discord OAuth callback:', error);
                    alert('خطأ في تسجيل الدخول عبر Discord: ' + error.message);
                    showPage('home-page'); 
                }
            }
        }

        async function logoutUser() {
            try {
                await fetch(`${BASE_API_URL}/auth/logout`, { method: 'POST' });
            } catch (error) {
                console.error('Error during backend logout:', error);
            }
            localStorage.removeItem('discord_user');
            localStorage.removeItem('session_token');
            updateLoginDisplay();
            showPage('home-page'); 
        }

        async function updateLoginDisplay() {
            const discordUser = JSON.parse(localStorage.getItem('discord_user'));
            const sessionToken = localStorage.getItem('session_token');

            if (discordUser && sessionToken) {
                try {
                    const response = await fetch(`${BASE_API_URL}/auth/verify`, {
                        headers: { 'Authorization': `Bearer ${sessionToken}` }
                    });
                    if (!response.ok) {
                        throw new Error('Session invalid');
                    }
                    const data = await response.json();

                    loggedInUsernameSpan.textContent = `مرحباً، ${data.user.username}`;
                    loggedInAvatarImg.src = `https://cdn.discordapp.com/avatars/${data.user.id}/${data.user.avatar}.png`;
                    loggedInAvatarImg.style.display = 'inline-block';
                    loggedInUserInfo.style.display = 'flex'; // إظهار معلومات المستخدم
                    discordLoginBtn.style.display = 'none'; // إخفاء زر تسجيل الدخول بالديسكورد

                    const isAdmin = data.user.isAdmin || ADMIN_DISCORD_IDS.includes(data.user.id);
                    
                    if (isAdmin) {
                        adminPanelNavItem.style.display = 'block';
                    } else {
                        adminPanelNavItem.style.display = 'none';
                    }

                } catch (error) {
                    console.error('Session verification failed:', error);
                    localStorage.removeItem('discord_user');
                    localStorage.removeItem('session_token');
                    loggedInUserInfo.style.display = 'none'; // إخفاء معلومات المستخدم
                    discordLoginBtn.style.display = 'inline-flex'; // إظهار زر تسجيل الدخول بالديسكورد
                    adminPanelNavItem.style.display = 'none';
                }
            } else {
                loggedInUserInfo.style.display = 'none'; // إخفاء معلومات المستخدم
                discordLoginBtn.style.display = 'inline-flex'; // إظهار زر تسجيل الدخول بالديسكورد
                adminPanelNavItem.style.display = 'none';
            }
        }

        // --- عداد الزوار (الآن يستخدم الباك إند) ---
        async function updateVisitorCount() {
            try {
                const response = await fetch(`${BASE_API_URL}/visitors/increment`, { method: 'POST' });
                if (!response.ok) {
                    throw new Error('Failed to increment visitor count');
                }
                const data = await response.json();
                visitorCountSpan.textContent = data.currentVisitors || 'خطأ';
                totalVisitorCountSpan.textContent = data.totalVisitors || 'خطأ';
            } catch (error) {
                console.error('Error updating visitor count:', error);
                visitorCountSpan.textContent = 'خطأ';
                totalVisitorCountSpan.textContent = 'خطأ';
            }
        }

        // --- نظام التقييمات (الآن يستخدم الباك إند وموافقة المشرف) ---
        const badWords = ["fuck", "shit", "asshole", "bitch", "لعنة", "قرف", "كلب", "ابن كلب", "متخلف", "حيوان"]; 

        function containsProfanity(text) {
            const lowerText = text.toLowerCase();
            return badWords.some(word => lowerText.includes(word));
        }

        function filterProfanity(text) {
            let filteredText = text;
            badWords.forEach(word => {
                const regex = new RegExp(word, 'gi');
                filteredText = filteredText.replace(regex, '*'.repeat(word.length));
            });
            return filteredText;
        }

        async function submitReview() {
            const reviewText = document.getElementById('review-text').value.trim();
            const discordUser = JSON.parse(localStorage.getItem('discord_user'));

            if (!discordUser) {
                showMessage('review-message', 'error', 'يجب تسجيل الدخول لإرسال تقييم.');
                return;
            }

            if (reviewText.length < 10) {
                showMessage('review-message', 'error', 'التقييم قصير جداً، الحد الأدنى 10 أحرف.');
                return;
            }
            if (reviewText.length > 500) {
                showMessage('review-message', 'error', 'التقييم طويل جداً، الحد الأقصى 500 حرف.');
                return;
            }

            if (containsProfanity(reviewText)) {
                showMessage('review-message', 'error', 'التقييم يحتوي على كلمات غير لائقة. يرجى التعديل.');
                return;
            }

            try {
                const response = await fetch(`${BASE_API_URL}/reviews`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('session_token')}` 
                    },
                    body: JSON.stringify({
                        userId: discordUser.id,
                        username: discordUser.username,
                        avatar: discordUser.avatar,
                        text: reviewText
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'فشل إرسال التقييم.');
                }

                showMessage('review-message', 'success', 'تم إرسال التقييم بنجاح! سيظهر بعد موافقة المشرفين.');
                document.getElementById('review-text').value = '';
            } catch (error) {
                console.error('Error submitting review:', error);
                showMessage('review-message', 'error', 'حدث خطأ أثناء إرسال التقييم: ' + error.message);
            }
        }

        async function loadReviews() {
            // هذا يحمل أحدث 5 تقييمات معتمدة للقسم الرئيسي "أحدث التقييمات"
            try {
                const response = await fetch(`${BASE_API_URL}/reviews?status=approved&limit=5`); 
                if (!response.ok) {
                    throw new Error('Failed to load reviews');
                }
                const reviews = await response.json();
                reviewsList.innerHTML = '<h3>أحدث التقييمات:</h3>';
                if (reviews.length === 0) {
                    reviewsList.innerHTML += '<p>لا توجد تقييمات حالياً.</p>';
                } else {
                    reviews.forEach(review => {
                        const reviewCard = document.createElement('div');
                        reviewCard.classList.add('review-card');
                        reviewCard.innerHTML = `
                            <strong>${review.username || 'مستخدم مجهول'}</strong>
                            <p>${filterProfanity(review.text)}</p>
                            <small>${new Date(review.createdAt).toLocaleString('ar-EG')}</small>
                        `;
                        reviewsList.appendChild(reviewCard);
                    });
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
                reviewsList.innerHTML = '<p>حدث خطأ أثناء تحميل التقييمات.</p>';
            }
        }

        // --- جديد: تحميل جميع التقييمات المعتمدة لقسم "التقييمات السابقة" ---
        async function loadPreviousReviews() {
            try {
                const response = await fetch(`${BASE_API_URL}/reviews?status=approved`); 
                if (!response.ok) {
                    throw new Error('Failed to load previous reviews');
                }
                const reviews = await response.json();
                approvedReviewsList.innerHTML = ''; 
                if (reviews.length === 0) {
                    noApprovedReviewsMsg.style.display = 'block';
                } else {
                    noApprovedReviewsMsg.style.display = 'none';
                    reviews.forEach(review => {
                        const reviewCard = document.createElement('div');
                        reviewCard.classList.add('review-card');
                        reviewCard.innerHTML = `
                            <strong>${review.username || 'مستخدم مجهول'}</strong>
                            <p>${filterProfanity(review.text)}</p>
                            <small>${new Date(review.createdAt).toLocaleString('ar-EG')}</small>
                        `;
                        approvedReviewsList.appendChild(reviewCard);
                    });
                }
            } catch (error) {
                console.error('Error loading previous reviews:', error);
                approvedReviewsList.innerHTML = '<p>حدث خطأ أثناء تحميل التقييمات السابقة.</p>';
                noApprovedReviewsMsg.style.display = 'none';
            }
        }

        // --- وظائف لوحة المشرفين ---
        async function loadPendingReviews() {
            pendingReviewsList.innerHTML = '<h3>التقييمات المعلقة:</h3>'; 
            noPendingReviewsMsg.style.display = 'none';

            try {
                const response = await fetch(`${BASE_API_URL}/admin/reviews?status=pending`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('session_token')}` 
                    }
                });
                if (!response.ok) {
                    if (response.status === 403) { 
                        pendingReviewsList.innerHTML += '<p>ليس لديك صلاحية الوصول إلى لوحة المشرفين.</p>';
                    } else {
                        throw new Error('Failed to load pending reviews');
                    }
                    return;
                }
                const reviews = await response.json();

                if (reviews.length === 0) {
                    noPendingReviewsMsg.style.display = 'block';
                } else {
                    reviews.forEach(review => {
                        const reviewItem = document.createElement('div');
                        reviewItem.classList.add('admin-review-item');
                        reviewItem.innerHTML = `
                            <div class="review-info">
                                <strong>${review.username || 'مستخدم مجهول'}</strong>
                                <p>${review.text}</p>
                                <small>معرف التقييم: ${review.id || 'N/A'} | تاريخ الإرسال: ${new Date(review.createdAt).toLocaleString('ar-EG')}</small>
                            </div>
                            <div class="review-actions">
                                <button class="approve-btn" onclick="approveReview('${review.id}')">موافقة</button>
                                <button class="delete-btn" onclick="deleteReview('${review.id}')">حذف</button>
                            </div>
                        `;
                        pendingReviewsList.appendChild(reviewItem);
                    });
                }
            } catch (error) {
                console.error('Error loading pending reviews:', error);
                pendingReviewsList.innerHTML += '<p>حدث خطأ أثناء تحميل التقييمات المعلقة. تأكد من أنك مشرف.</p>';
            }
        }

        async function approveReview(reviewId) {
            try {
                const response = await fetch(`${BASE_API_URL}/admin/reviews/${reviewId}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('session_token')}` 
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'فشل الموافقة على التقييم');
                }
                showMessage('review-message', 'success', 'تمت الموافقة على التقييم بنجاح!');
                loadPendingReviews(); 
                loadReviews(); 
                loadPreviousReviews(); 
            } catch (error) {
                console.error('Error approving review:', error);
                showMessage('review-message', 'error', 'حدث خطأ أثناء الموافقة على التقييم: ' + error.message);
            }
        }

        async function deleteReview(reviewId) {
            if (!confirm('هل أنت متأكد أنك تريد حذف هذا التقييم؟')) {
                return;
            }
            try {
                const response = await fetch(`${BASE_API_URL}/admin/reviews/${reviewId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('session_token')}` 
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'فشل حذف التقييم');
                }
                showMessage('review-message', 'success', 'تم حذف التقييم بنجاح!');
                loadPendingReviews(); 
                loadReviews(); 
                loadPreviousReviews(); 
            } catch (error) {
                console.error('Error deleting review:', error);
                showMessage('review-message', 'error', 'حدث خطأ أثناء حذف التقييم: ' + error.message);
            }
        }

        // --- جديد: حالة سيرفر Aternos ---
        async function updateServerStatus() {
            serverStatusText.textContent = 'جاري التحميل...';
            serverStatusIndicator.className = 'status-indicator'; 
            playersOnline.textContent = 'جاري التحميل...';

            try {
                const response = await fetch(`${BASE_API_URL}/aternoss-status`);
                if (!response.ok) {
                    throw new Error('Failed to fetch server status');
                }
                const data = await response.json(); 

                if (data.status === 'online') {
                    serverStatusText.textContent = 'متصل';
                    serverStatusIndicator.classList.add('online');
                    playersOnline.textContent = data.players.online + '/' + data.players.max;
                } else {
                    serverStatusText.textContent = 'غير متصل';
                    serverStatusIndicator.classList.add('offline');
                    playersOnline.textContent = '0/0';
                }
            } catch (error) {
                console.error('Error fetching Aternos status:', error);
                serverStatusText.textContent = 'خطأ في التحميل';
                serverStatusIndicator.classList.add('offline');
                playersOnline.textContent = 'غير متاح';
            }
        }

        // --- وظيفة مساعدة للرسائل ---
        function showMessage(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message-area ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000); 
        }

        // --- التهيئة عند تحميل الصفحة ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark'; 
            setMode(savedTheme);

            if (window.location.pathname.includes('/auth/discord/callback')) {
                handleDiscordCallback();
            } else {
                updateLoginDisplay();
            }
            
            showPage('home-page'); 
            updateVisitorCount(); 
        });
    </script>
</body>
</html>
